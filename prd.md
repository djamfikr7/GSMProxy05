ProxyGSM Remote Proxy System: Complete Technical Specification (PRD v2.0)
Document ID: PRD-GSM-2025-11-27
Version: 2.0
Status: Implementation-Ready
Design System: Material 3 + Custom Design Tokens
Target Audience: Technical Leads, Flutter Architects, UI/UX Designers, Development Agencies
1. Executive Summary & UI Vision
The GSM Remote Proxy System transforms any modern Android smartphone into a remotely controllable GSM gateway with studio-quality UI/UX that feels native on every platform. The controller application delivers 60fps animations, context-aware micro-interactions, and adaptive layouts that seamlessly transition between mobile, tablet, and desktop form factors.
Key UI Differentiators:
Flutter Flow Integration: 80% of UI built visually, exported to clean Flutter code
Material 3 Expressive: Dynamic color, motion tokens, surface elevation
Platform Adaptivity: Cupertino on iOS, Material on Android, Fluent on Windows
Performance First: Shader pre-compilation, image decoding offloading, predictive loading
Accessibility AAA: WCAG 2.2 compliance, screen reader optimization, reduced motion support
2. Design System Architecture
2.1 Design Tokens (Centralized in lib/design/tokens.dart)
dart
Copy
// File: lib/design/tokens.dart
class AppTokens {
  // Colors (Material 3 Dynamic)
  static const Color dynamicPrimary = Color(0xFF6750A4);
  static const Color dynamicOnPrimary = Color(0xFFFFFFFF);
  static const Color dynamicSurface = Color(0xFFFEFBFF);
  static const Color dynamicSurfaceVariant = Color(0xFFE7E0EC);
  static const Color dynamicError = Color(0xFFB3261E);
  
  // Dark Mode
  static const Color darkPrimary = Color(0xFFD0BCFF);
  static const Color darkSurface = Color(0xFF1D1B20);
  
  // Typography (Google Fonts - Inter)
  static const TextStyle displayLarge = TextStyle(
    fontFamily: 'Inter',
    fontSize: 57,
    fontWeight: FontWeight.w400,
    letterSpacing: -0.25,
    height: 1.12,
  );
  
  static const TextStyle titleMedium = TextStyle(
    fontFamily: 'Inter',
    fontSize: 16,
    fontWeight: FontWeight.w500,
    letterSpacing: 0.15,
    height: 1.5,
  );
  
  // Spacing (8pt grid)
  static const double space1 = 4.0;
  static const double space2 = 8.0;
  static const double space3 = 12.0;
  static const double space4 = 16.0;
  static const double space6 = 24.0;
  static const double space8 = 32.0;
  
  // Motion (Easing)
  static const Curve emphasis = Cubic(0.2, 0.0, 0.0, 1.0); // Emphasized
  static const Curve standard = Cubic(0.2, 0.0, 0.0, 1.0); // Standard
  static const Duration durationShort = Duration(milliseconds: 200);
  static const Duration durationMedium = Duration(milliseconds: 400);
  static const Duration durationLong = Duration(milliseconds: 600);
}
2.2 Flutter Flow Component Library
All screens are designed in Flutter Flow and exported to lib/ui/flow_generated/. Custom components extend these with business logic.
Flow Export Rules:
Component Naming: ff_[screen]_[element].dart (e.g., ff_dashboard_call_button.dart)
State Injection: Flow widgets accept ProxyGsmController via constructor
Theming: Flow components use AppTokens exclusively
Animation: Flow animations converted to ImplicitlyAnimatedWidget subclasses
dart
Copy
// Generated by Flutter Flow - DO NOT EDIT MANUALLY
// File: lib/ui/flow_generated/ff_dashboard_screen.dart
class FlowDashboardScreen extends StatelessWidget {
  final ProxyGsmController controller;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTokens.dynamicSurface,
      body: SafeArea(
        child: Column(
          children: [
            _buildStatusBar(controller),
            Expanded(child: _buildScreenPreview(controller)),
            _buildNavigationRail(controller),
          ],
        ),
      ),
    );
  }
  
  Widget _buildStatusBar(ProxyGsmController controller) {
    return Container(
      margin: EdgeInsets.all(AppTokens.space4),
      padding: EdgeInsets.symmetric(horizontal: AppTokens.space4, vertical: AppTokens.space3),
      decoration: BoxDecoration(
        color: AppTokens.dynamicSurfaceVariant,
        borderRadius: BorderRadius.circular(AppTokens.space3),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 8,
            offset: Offset(0, 2),
          ),
        ],
      ),
      child: Row(
        children: [
          LatencyIndicator(rttMs: controller.latencyMs),
          Spacer(),
          SimSlotSelector(controller: controller),
        ],
      ),
    );
  }
}
3. UI/UX Specifications by Screen
3.1 Splash & Pairing Flow
Flow: Splash → Permissions → QR Scan → Biometric Auth → Dashboard
dart
Copy
// lib/ui/screens/pairing_screen.dart
class PairingScreen extends StatefulWidget {
  @override
  State<PairingScreen> createState() => _PairingScreenState();
}

class _PairingScreenState extends State<PairingScreen> with SingleTickerProviderStateMixin {
  late AnimationController _scannerController;
  
  @override
  void initState() {
    super.initState();
    _scannerController = AnimationController(
      duration: AppTokens.durationLong * 2,
      vsync: this,
    )..repeat(reverse: true);
  }
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppTokens.dynamicSurface,
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            // Animated QR Scanner Frame
            AnimatedBuilder(
              animation: _scannerController,
              builder: (context, child) {
                return Container(
                  width: 250,
                  height: 250,
                  decoration: BoxDecoration(
                    border: Border.all(
                      color: AppTokens.dynamicPrimary.withOpacity(0.3 + _scannerController.value * 0.7),
                      width: 4,
                    ),
                    borderRadius: BorderRadius.circular(AppTokens.space4),
                  ),
                  child: QRView(onQRViewCreated: _onQRViewCreated),
                );
              },
            ),
            SizedBox(height: AppTokens.space6),
            Text(
              'Scan Device QR Code',
              style: AppTokens.titleMedium.copyWith(color: AppTokens.dynamicOnSurface),
            ),
            SizedBox(height: AppTokens.space3),
            Text(
              'Position the QR code within the frame',
              style: AppTokens.bodyMedium.copyWith(color: AppTokens.dynamicOnSurfaceVariant),
            ),
          ],
        ),
      ),
    );
  }
  
  void _onQRViewCreated(QRViewController controller) {
    controller.scannedDataStream.listen((scanData) {
      // Haptic feedback
      HapticFeedback.mediumImpact();
      // Animated transition
      Navigator.of(context).push(
        PageRouteBuilder(
          transitionDuration: AppTokens.durationMedium,
          pageBuilder: (_, __, ___) => BiometricAuthScreen(qrData: scanData.code!),
          transitionsBuilder: (_, animation, __, child) {
            return FadeTransition(
              opacity: CurvedAnimation(parent: animation, curve: AppTokens.emphasis),
              child: child,
            );
          },
        ),
      );
    });
  }
}
Visual Design Notes:
QR Frame: Pulsing border using AnimatedBuilder with CurvedAnimation
Typography: titleMedium for headline, bodyMedium for subtitle
Spacing: 24pt between major elements, 12pt between text lines
Haptics: Medium impact on successful scan (iOS: UISelectionFeedbackGenerator)
3.2 Main Dashboard (Adaptive Layout)
Breakpoints:
Mobile (<600dp): Bottom navigation, full-width cards
Tablet (600-1024dp): Navigation rail, 2-column grid
Desktop (>1024dp): Permanent navigation drawer, 3-column grid
dart
Copy
// lib/ui/screens/dashboard_screen.dart
class DashboardScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        if (constraints.maxWidth < 600) {
          return _MobileDashboard();
        } else if (constraints.maxWidth < 1024) {
          return _TabletDashboard();
        } else {
          return _DesktopDashboard();
        }
      },
    );
  }
}

class _DesktopDashboard extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Row(
        children: [
          // Permanent Navigation Drawer
          _buildNavigationDrawer(),
          // Main Content Area
          Expanded(
            child: Column(
              children: [
                _buildHeaderBar(),
                Expanded(child: _buildThreeColumnLayout()),
              ],
            ),
          ),
        ],
      ),
    );
  }
  
  Widget _buildThreeColumnLayout() {
    return Row(
      children: [
        // Column 1: Screen Preview (60% width)
        Expanded(
          flex: 3,
          child: Container(
            margin: EdgeInsets.all(AppTokens.space4),
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(AppTokens.space4),
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(0.15),
                  blurRadius: 12,
                  offset: Offset(0, 4),
                ),
              ],
            ),
            child: ClipRRect(
              borderRadius: BorderRadius.circular(AppTokens.space4),
              child: ScreenProjectionViewer(),
            ),
          ),
        ),
        // Column 2: Controls & Call Log (27% width)
        Expanded(
          flex: 2,
          child: Column(
            children: [
              _CallControlPanel(),
              SizedBox(height: AppTokens.space4),
              Expanded(child: _RecentCallLog()),
            ],
          ),
        ),
        // Column 3: Quick Actions & Messages (13% width)
        Container(
          width: 200,
          child: Column(
            children: [
              _QuickActions(),
              SizedBox(height: AppTokens.space4),
              Expanded(child: _MessagePreview()),
            ],
          ),
        ),
      ],
    );
  }
}
Flutter Flow Export: Desktop layout designed as ff_dashboard_desktop_layout with responsive constraints. Custom code overlays business logic.
3.3 Screen Projection Viewer (60fps Optimized)
dart
Copy
// lib/ui/widgets/screen_projection_viewer.dart
class ScreenProjectionViewer extends StatefulWidget {
  @override
  State<ScreenProjectionViewer> createState() => _ScreenProjectionViewerState();
}

class _ScreenProjectionViewerState extends State<ScreenProjectionViewer> {
  final TransformationController _transformationController = TransformationController();
  
  @override
  Widget build(BuildContext context) {
    return Consumer<ScreenProjectionController>(
      builder: (context, controller, child) {
        return Stack(
          children: [
            // Background placeholder while loading
            if (controller.isLoading)
              Shimmer.fromColors(
                baseColor: AppTokens.dynamicSurfaceVariant,
                highlightColor: AppTokens.dynamicSurface,
                child: Container(color: Colors.white),
              ),
            
            // Actual screen frame
            if (controller.frameData != null)
              InteractiveViewer(
                transformationController: _transformationController,
                minScale: 0.5,
                maxScale: 3.0,
                panEnabled: true,
                scaleEnabled: true,
                onInteractionUpdate: (details) {
                  // Send pinch-to-zoom to device
                  if (details.scale != 1.0) {
                    _sendZoomGesture(details.scale);
                  }
                },
                child: Image.memory(
                  controller.frameData!,
                  gaplessPlayback: true,
                  fit: BoxFit.contain,
                  filterQuality: FilterQuality.medium,
                  excludeFromSemantics: true, // Important for performance
                ),
              ),
            
            // Overlay: Touch indicators (predictive)
            ...controller.predictionPoints.map((point) => 
              AnimatedPositioned(
                duration: AppTokens.durationShort,
                left: point.dx - 20,
                top: point.dy - 20,
                child: Container(
                  width: 40,
                  height: 40,
                  decoration: BoxDecoration(
                    shape: BoxShape.circle,
                    border: Border.all(
                      color: AppTokens.dynamicPrimary.withOpacity(0.5),
                      width: 2,
                    ),
                  ),
                ),
              ),
            ).toList(),
            
            // Overlay: Latency indicator (top-right)
            Positioned(
              top: AppTokens.space4,
              right: AppTokens.space4,
              child: LatencyIndicator(rttMs: controller.rttMs),
            ),
          ],
        );
      },
    );
  }
  
  void _sendZoomGesture(double scale) {
    // Convert pinch scale to device coordinates
    final deviceScale = (scale * 100).round();
    WebSocketManager().send('{"type":"gesture.zoom","scale":$deviceScale}');
  }
}
Performance Optimizations:
Image.memory: gaplessPlayback: true prevents flicker between frames
InteractiveViewer: Hardware-accelerated transformation matrix
Shimmer: Skeleton loading during initial connection
Prediction Points: Animated with AnimatedPositioned for 60fps
3.4 Dialer & Call UI
dart
Copy
// lib/ui/widgets/dialer_pad.dart
class DialerPad extends StatefulWidget {
  @override
  State<DialerPad> createState() => _DialerPadState();
}

class _DialerPadState extends State<DialerPad> with SingleTickerProviderStateMixin {
  late AnimationController _padController;
  
  @override
  void initState() {
    super.initState();
    _padController = AnimationController(
      duration: AppTokens.durationMedium,
      vsync: this,
    );
  }
  
  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.all(AppTokens.space6),
      child: Column(
        children: [
          // Number Display
          Consumer<CallController>(
            builder: (context, controller, _) {
              return AnimatedContainer(
                duration: AppTokens.durationShort,
                curve: AppTokens.emphasis,
                height: controller.isDialing ? 80 : 60,
                child: Text(
                  controller.displayNumber,
                  style: controller.isDialing
                      ? AppTokens.displaySmall
                      : AppTokens.headlineMedium,
                  textAlign: TextAlign.center,
                ),
              );
            },
          ),
          SizedBox(height: AppTokens.space6),
          
          // Dial Pad (4x3 grid)
          GridView.builder(
            shrinkWrap: true,
            gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
              crossAxisCount: 3,
              childAspectRatio: 1.2,
              crossAxisSpacing: AppTokens.space3,
              mainAxisSpacing: AppTokens.space3,
            ),
            itemCount: 12, // 0-9, *, #
            itemBuilder: (context, index) {
              final digit = _getDigitForIndex(index);
              return _DialPadButton(
                digit: digit,
                onTap: () => _onDigitTap(digit),
              );
            },
          ),
          
          // Action Buttons
          SizedBox(height: AppTokens.space6),
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceEvenly,
            children: [
              _ActionButton(
                icon: Icons.clear,
                color: AppTokens.dynamicError,
                onTap: _clearNumber,
              ),
              _ActionButton(
                icon: Icons.call,
                color: AppTokens.dynamicPrimary,
                onTap: _initiateCall,
                size: 72,
              ),
              _ActionButton(
                icon: Icons.backspace,
                color: AppTokens.dynamicOnSurfaceVariant,
                onTap: _backspace,
              ),
            ],
          ),
        ],
      ),
    );
  }
}

class _DialPadButton extends StatelessWidget {
  final String digit;
  final VoidCallback onTap;
  
  @override
  Widget build(BuildContext context) {
    return Material(
      color: AppTokens.dynamicSurfaceVariant,
      borderRadius: BorderRadius.circular(AppTokens.space3),
      child: InkWell(
        onTap: () {
          HapticFeedback.lightImpact();
          onTap();
        },
        borderRadius: BorderRadius.circular(AppTokens.space3),
        child: Container(
          alignment: Alignment.center,
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Text(
                digit,
                style: AppTokens.displaySmall.copyWith(
                  color: AppTokens.dynamicOnSurface,
                ),
              ),
              if (_hasLetters(digit))
                Text(
                  _getLetters(digit),
                  style: AppTokens.labelSmall.copyWith(
                    color: AppTokens.dynamicOnSurfaceVariant,
                  ),
                ),
            ],
          ),
        ),
      ),
    );
  }
}
Micro-interactions:
Haptic: Light impact on digit press
Animation: Number display scales up when dialing (emphasized curve)
Call Button: 72pt size with shadow elevation 3dp
Typography: Letters under digits use labelSmall for visual hierarchy
3.5 Active Call Screen with Audio Visualization
dart
Copy
// lib/ui/widgets/active_call_screen.dart
class ActiveCallScreen extends StatefulWidget {
  @override
  State<ActiveCallScreen> createState() => _ActiveCallScreenState();
}

class _ActiveCallScreenState extends State<ActiveCallScreen> with SingleTickerProviderStateMixin {
  late AnimationController _audioVisualizerController;
  
  @override
  void initState() {
    super.initState();
    _audioVisualizerController = AnimationController(
      duration: Duration(seconds: 2),
      vsync: this,
    )..repeat();
  }
  
  @override
  Widget build(BuildContext context) {
    return Consumer<CallController>(
      builder: (context, controller, _) {
        return Scaffold(
          backgroundColor: AppTokens.dynamicSurface,
          body: Column(
            children: [
              // Status Bar (with latency)
              _buildStatusBar(controller),
              
              // Caller Info & Audio Visualizer
              Expanded(
                child: Center(
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      // Contact Avatar
                      Hero(
                        tag: 'caller_avatar_${controller.callId}',
                        child: CircleAvatar(
                          radius: 64,
                          backgroundColor: AppTokens.dynamicPrimary,
                          child: Text(
                            controller.contactName[0],
                            style: AppTokens.displayLarge.copyWith(
                              color: AppTokens.dynamicOnPrimary,
                            ),
                          ),
                        ),
                      ),
                      SizedBox(height: AppTokens.space6),
                      
                      // Phone Number & Name
                      Text(
                        controller.contactName,
                        style: AppTokens.headlineMedium,
                      ),
                      Text(
                        controller.formattedNumber,
                        style: AppTokens.bodyLarge.copyWith(
                          color: AppTokens.dynamicOnSurfaceVariant,
                        ),
                      ),
                      SizedBox(height: AppTokens.space8),
                      
                      // Audio Level Visualizer (WebRTC)
                      AnimatedBuilder(
                        animation: _audioVisualizerController,
                        builder: (context, child) {
                          return CustomPaint(
                            size: Size(200, 100),
                            painter: AudioWaveformPainter(
                              amplitude: controller.remoteAudioLevel,
                              animationValue: _audioVisualizerController.value,
                            ),
                          );
                        },
                      ),
                    ],
                  ),
                ),
              ),
              
              // Call Action Buttons
              _buildCallActionButtons(controller),
            ],
          ),
        );
      },
    );
  }
  
  Widget _buildCallActionButtons(CallController controller) {
    return Container(
      padding: EdgeInsets.all(AppTokens.space6),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceEvenly,
        children: [
          _CallActionButton(
            icon: Icons.mic_off,
            label: 'Mute',
            onTap: controller.toggleMute,
            isActive: controller.isMuted,
          ),
          _CallActionButton(
            icon: Icons.volume_up,
            label: 'Speaker',
            onTap: controller.toggleSpeaker,
            isActive: controller.isSpeakerOn,
          ),
          _CallActionButton(
            icon: Icons.dialpad,
            label: 'Keypad',
            onTap: () => _showDialpad(context),
          ),
          _CallActionButton(
            icon: Icons.call_end,
            label: 'End',
            color: AppTokens.dynamicError,
            onTap: controller.hangUp,
            size: 64,
          ),
        ],
      ),
    );
  }
}

class AudioWaveformPainter extends CustomPainter {
  final double amplitude;
  final double animationValue;
  
  @override
  void paint(Canvas canvas, Size size) {
    final paint = Paint()
      ..color = AppTokens.dynamicPrimary
      ..strokeWidth = 3
      ..strokeCap = StrokeCap.round;
    
    final barWidth = size.width / 20;
    final centerY = size.height / 2;
    
    for (int i = 0; i < 20; i++) {
      final barHeight = (amplitude * size.height * 0.8 * (0.5 + animationValue * 0.5)).abs();
      final x = i * barWidth;
      final y = centerY - barHeight / 2;
      
      canvas.drawRRect(
        RRect.fromRectAndRadius(
          Rect.fromLTWH(x, y, barWidth * 0.8, barHeight),
          Radius.circular(2),
        ),
        paint,
      );
    }
  }
  
  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => true;
}
Visual Effects:
Hero Animation: Avatar flies in from dialer pad
Audio Visualizer: 20 bars pulsing with WebRTC audio level
Button States: Active state shows dynamicPrimary background
3.6 Messages & Conversation Thread
dart
Copy
// lib/ui/screens/conversation_screen.dart
class ConversationScreen extends StatefulWidget {
  final String threadId;
  
  @override
  State<ConversationScreen> createState() => _ConversationScreenState();
}

class _ConversationScreenState extends State<ConversationScreen> {
  final _scrollController = ScrollController();
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: _buildAppBarContent(),
        backgroundColor: AppTokens.dynamicSurface,
        elevation: 0,
        bottom: PreferredSize(
          preferredSize: Size.fromHeight(1),
          child: Container(color: AppTokens.dynamicSurfaceVariant, height: 1),
        ),
      ),
      body: Column(
        children: [
          // Message List (reversed for newest at bottom)
          Expanded(
            child: Consumer<MessageController>(
              builder: (context, controller, _) {
                return ListView.builder(
                  controller: _scrollController,
                  reverse: true,
                  padding: EdgeInsets.all(AppTokens.space4),
                  itemCount: controller.messages.length,
                  itemBuilder: (context, index) {
                    final message = controller.messages[controller.messages.length - 1 - index];
                    return _MessageBubble(message: message);
                  },
                );
              },
            ),
          ),
          
          // Message Composer
          _MessageComposer(onSend: (text) => _sendMessage(text)),
        ],
      ),
    );
  }
}

class _MessageBubble extends StatelessWidget {
  final SmsMessage message;
  
  @override
  Widget build(BuildContext context) {
    final isSent = message.type == "sent";
    return Align(
      alignment: isSent ? Alignment.centerRight : Alignment.centerLeft,
      child: Container(
        margin: EdgeInsets.symmetric(vertical: AppTokens.space2),
        padding: EdgeInsets.symmetric(
          horizontal: AppTokens.space4,
          vertical: AppTokens.space3,
        ),
        decoration: BoxDecoration(
          color: isSent ? AppTokens.dynamicPrimary : AppTokens.dynamicSurfaceVariant,
          borderRadius: BorderRadius.circular(AppTokens.space4).copyWith(
            bottomRight: isSent ? Radius.zero : null,
            bottomLeft: isSent ? null : Radius.zero,
          ),
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.end,
          children: [
            Text(
              message.body,
              style: AppTokens.bodyMedium.copyWith(
                color: isSent ? AppTokens.dynamicOnPrimary : AppTokens.dynamicOnSurface,
              ),
            ),
            SizedBox(height: AppTokens.space1),
            Text(
              _formatTime(message.timestamp),
              style: AppTokens.labelSmall.copyWith(
                color: (isSent ? AppTokens.dynamicOnPrimary : AppTokens.dynamicOnSurfaceVariant)
                    .withOpacity(0.7),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

class _MessageComposer extends StatefulWidget {
  final Function(String) onSend;
  
  @override
  State<_MessageComposer> createState() => __MessageComposerState();
}

class __MessageComposerState extends State<_MessageComposer> {
  final _controller = TextEditingController();
  
  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.all(AppTokens.space4),
      decoration: BoxDecoration(
        color: AppTokens.dynamicSurface,
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 8,
            offset: Offset(0, -2),
          ),
        ],
      ),
      child: Row(
        children: [
          IconButton(
            icon: Icon(Icons.attach_file),
            onPressed: _showAttachmentOptions,
            color: AppTokens.dynamicOnSurfaceVariant,
          ),
          Expanded(
            child: TextField(
              controller: _controller,
              decoration: InputDecoration(
                hintText: 'Type a message...',
                hintStyle: AppTokens.bodyLarge.copyWith(
                  color: AppTokens.dynamicOnSurfaceVariant,
                ),
                border: InputBorder.none,
              ),
              style: AppTokens.bodyLarge,
              onSubmitted: (text) => _send(text),
            ),
          ),
          IconButton(
            icon: Icon(Icons.send),
            onPressed: () => _send(_controller.text),
            color: AppTokens.dynamicPrimary,
          ),
        ],
      ),
    );
  }
}
UX Details:
Bubble Corners: Sender messages have bottom-right radius zero, receiver bottom-left zero
Time Stamps: 70% opacity, labelSmall for visual hierarchy
Composer Shadow: Elevated above keyboard with subtle top shadow
Auto-scroll: On new message, animate to bottom using AnimatedList
4. State Management Architecture
4.1 Riverpod Provider Hierarchy
dart
Copy
// lib/providers/providers.dart

// Global Providers
final webSocketProvider = Provider<WebSocketManager>((ref) => WebSocketManager());
final webrtcProvider = Provider<WebRtcManager>((ref) => WebRtcManager());

// Feature Controllers
final screenProjectionController = StateNotifierProvider<ScreenProjectionController, ScreenState>(
  (ref) => ScreenProjectionController(ref.read(webSocketProvider)),
);

final callController = StateNotifierProvider<CallController, CallState>(
  (ref) => CallController(ref.read(webSocketProvider)),
);

final messageController = StateNotifierProvider<MessageController, MessageState>(
  (ref) => MessageController(ref.read(webSocketProvider)),
);

// UI State Providers
final latencyProvider = StreamProvider<int>((ref) {
  return ref.read(webSocketProvider).latencyStream;
});

final biometricAuthProvider = FutureProvider<bool>((ref) async {
  final auth = LocalAuthentication();
  return await auth.canCheckBiometrics;
});
Flutter Flow Integration: Flow components consume these providers via ConsumerWidget.
4.2 State Sync with WebSocket
dart
Copy
// lib/controllers/screen_projection_controller.dart
class ScreenProjectionController extends StateNotifier<ScreenState> {
  final WebSocketManager _ws;
  
  ScreenProjectionController(this._ws) : super(ScreenState.initial()) {
    _ws.onFrame.listen((frameData) {
      // Decode JPEG on isolate to avoid UI jank
      compute(decodeBase64Jpeg, frameData).then((image) {
        state = state.copyWith(frameData: image, isLoading: false);
      });
    });
    
    _ws.onLatencyUpdate.listen((rtt) {
      state = state.copyWith(rttMs: rtt);
    });
  }
  
  static Uint8List decodeBase64Jpeg(String base64Data) {
    return base64Decode(base64Data);
  }
}
Performance: Image decoding offloaded to compute isolate → 60fps maintained.
5. Flutter Flow Implementation Workflow
5.1 Design-to-Code Pipeline
Step 1: Design in Flutter Flow
Use Material 3 component library
Bind UI elements to design tokens (colors, typography)
Define page states (loading, error, success)
Configure animations (duration, easing)
Export to lib/ui/flow_generated/
Step 2: Add Business Logic Overlay
dart
Copy
// lib/ui/screens/dashboard_screen.dart
// Wraps Flutter Flow generated widget

class DashboardScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final screenState = ref.watch(screenProjectionController);
    
    // Wrap Flow component with state
    return FlowDashboardScreen(
      controller: ref.read(screenProjectionController.notifier),
      frameData: screenState.frameData,
      latencyMs: screenState.rttMs,
      isLoading: screenState.isLoading,
    );
  }
}
Step 3: Theming Sync
bash
Copy
# Script to sync Flutter Flow colors with AppTokens
# File: scripts/sync-flow-tokens.sh
#!/bin/bash
flutterflow export-themes --project-id proxygsm --output lib/design/flow_themes.dart
dart run bin/apply_tokens.dart  # Merges with AppTokens
6. Micro-Interactions & Animations
6.1 Haptic Feedback System
dart
Copy
// lib/ux/haptic_feedback_manager.dart
class HapticFeedbackManager {
  static void onButtonPress() {
    HapticFeedback.lightImpact(); // 10ms vibration
  }
  
  static void onCallConnect() {
    HapticFeedback.mediumImpact(); // 20ms vibration
  }
  
  static void onError() {
    HapticFeedback.heavyImpact(); // 30ms vibration
  }
  
  static void onLongPress() {
    HapticFeedback.selectionClick(); // 5ms light tick
  }
}
Usage: Every InkWell/GestureDetector calls HapticFeedbackManager.onButtonPress().
6.2 Loading States & Skeletons
dart
Copy
// lib/ui/widgets/shimmer_loading.dart
class ShimmerLoading extends StatelessWidget {
  final Widget child;
  final bool isLoading;
  
  @override
  Widget build(BuildContext context) {
    if (!isLoading) return child;
    
    return Shimmer.fromColors(
      baseColor: AppTokens.dynamicSurfaceVariant,
      highlightColor: AppTokens.dynamicSurface,
      child: Container(
        width: double.infinity,
        height: double.infinity,
        color: Colors.white,
      ),
    );
  }
}
Flutter Flow: Set loading state in component properties → auto-generates shimmer.
7. Performance Targets & Optimization
7.1 FPS Budget
Table
Copy
Operation	Target FPS	Optimization Technique
Screen projection	30fps	JPEG decode on isolate
Touch ripple	60fps	AnimatedContainer with hardware layer
Dial pad	60fps	RepaintBoundary around static elements
Audio visualizer	60fps	CustomPainter with partial repaint
Navigation	60fps	IndexedStack + pre-built routes
7.2 Shader Compilation
yaml
Copy
# pubspec.yaml
flutter:
  shaders:
    - assets/shaders/audio_visualizer.frag  # Custom GLSL shader for waveform
Precompile on build: flutter build apk --bundle-shaders
7.3 Image Decoding
dart
Copy
// Pre-cache contact avatars
final avatarCache = ImageCache();
avatarCache.maximumSize = 100; // 100 images

// In message list
Image(
  image: NetworkAvatarImage(url, cache: avatarCache),
  frameBuilder: (context, child, frame, wasSynchronouslyLoaded) {
    if (wasSynchronouslyLoaded) return child;
    return AnimatedOpacity(
      opacity: frame == null ? 0 : 1,
      duration: AppTokens.durationShort,
      child: child,
    );
  },
)
8. Accessibility & Internationalization
8.1 Accessibility (WCAG 2.2 AAA)
dart
Copy
// Semantics for screen readers
Semantics(
  label: 'Remote device screen viewer',
  value: 'Showing screen of ${device.name}. Latency ${latencyMs}ms',
  increasedValue: 'High latency detected. Predictive mode active.',
  onTap: () => _showAccessibilityHelp(),
  child: ScreenProjectionViewer(),
);

// High contrast mode support
class HighContrastWrapper extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final highContrast = MediaQuery.of(context).highContrast;
    return Theme(
      data: Theme.of(context).copyWith(
        colorScheme: highContrast
            ? _highContrastScheme
            : Theme.of(context).colorScheme,
      ),
      child: child,
    );
  }
}
8.2 Internationalization (i18n)
dart
Copy
// lib/l10n/app_en.arb
{
  "@@locale": "en",
  "screenViewerTitle": "Remote Screen",
  "callButtonLabel": "Call {number}",
  "@callButtonLabel": {
    "placeholders": {
      "number": {"type": "String"}
    }
  },
  "latencyHighWarning": "High latency detected"
}

// Generated l10n.dart
Text(AppLocalizations.of(context).screenViewerTitle)
Flutter Flow: Bind text keys to AppLocalizations in component properties.
9. Dark Mode Implementation
dart
Copy
// lib/theme/app_theme.dart
class AppTheme {
  static ThemeData get lightTheme => ThemeData(
        colorScheme: ColorScheme.light(
          primary: AppTokens.dynamicPrimary,
          surface: AppTokens.dynamicSurface,
          // ... other M3 colors
        ),
        brightness: Brightness.light,
      );
  
  static ThemeData get darkTheme => ThemeData(
        colorScheme: ColorScheme.dark(
          primary: AppTokens.darkPrimary,
          surface: AppTokens.darkSurface,
          // ... dark equivalents
        ),
        brightness: Brightness.dark,
      );
}

// In main.dart
MaterialApp(
  theme: AppTheme.lightTheme,
  darkTheme: AppTheme.darkTheme,
  themeMode: ThemeMode.system, // Respects OS preference
);
Flutter Flow: Toggle dark mode in preview to validate all components.
10. Flutter Flow Export & CI/CD Integration
10.1 Automated Export Workflow
yaml
Copy
# .github/workflows/flutterflow-sync.yml
name: Sync Flutter Flow Design

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Export from Flutter Flow
        run: |
          flutterflow export \
            --project-id proxygsm \
            --token ${{ secrets.FLUTTERFLOW_TOKEN }} \
            --output lib/ui/flow_generated/
      
      - name: Apply Design Tokens
        run: dart run bin/apply_tokens.dart
      
      - name: Run Code Generation
        run: flutter pub run build_runner build --delete-conflicting-outputs
      
      - name: Commit Changes
        run: |
          git add lib/ui/flow_generated/
          git commit -m "chore(ui): sync Flutter Flow design [skip ci]"
          git push
10.2 Manual Override Strategy
When Flow export needs customization:
dart
Copy
// lib/ui/overrides/dashboard_override.dart
class DashboardScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final flowWidget = FlowDashboardScreen(); // Generated
    
    // Add business logic overlay
    return Stack(
      children: [
        flowWidget,
        if (ref.watch(isLoadingProvider))
          ShimmerLoading(child: Container()),
        Positioned(
          top: 16,
          right: 16,
          child: LatencyIndicator(
            rttMs: ref.watch(latencyProvider).maybeWhen(
              data: (rtt) => rtt,
              orElse: () => 0,
            ),
          ),
        ),
      ],
    );
  }
}
11. Visual Design Mockups (Flutter Flow References)
Table
Copy
Screen	Flow Component ID	Notes
Splash	ff_splash_screen_v2	Animated logo, gradient background
Pairing	ff_pairing_qr_scanner	Pulsing QR frame, haptic feedback
Dashboard	ff_dashboard_adaptive	Responsive 3-column (desktop)
Dialer	ff_dialer_pad	M3 buttons, ripple animation
Active Call	ff_call_screen_waveform	Audio visualizer shader
Messages	ff_conversation_thread	Reversed ListView, bubble corners
Settings	ff_settings_panel	Navigation rail, segmented controls
12. Performance Monitoring & Dogfooding
dart
Copy
// lib/monitoring/ui_performance_monitor.dart
class UiPerformanceMonitor extends StatelessWidget {
  final Widget child;
  
  @override
  Widget build(BuildContext context) {
    return PerformanceOverlay(
      enabled: kDebugMode,
      child: child,
    );
  }
}

// In main.dart (debug mode)
MaterialApp(
  builder: (context, child) => UiPerformanceMonitor(child: child!),
);
FPS Budget Validation:
DevTools: Timeline view must show no janky frames (>16ms)
Profile Mode: Run flutter run --profile to measure real performance
Target: 99% frames within budget
13. Final UI Checklist
[ ] Flutter Flow Components: All screens exported and versioned
[ ] Design Tokens: AppTokens synced with Flow theme
[ ] Animations: All transitions use AppTokens.emphasis curve
[ ] Haptics: Every interactive element calls HapticFeedbackManager
[ ] Accessibility: Semantics labels on all interactive widgets
[ ] Dark Mode: Tested on all screens
[ ] Responsiveness: Validated on 5 screen sizes (mobile, tablet, desktop)
[ ] Performance: No frames >16ms in profile mode
[ ] i18n: All strings use AppLocalizations
[ ] Shimmer: Loading states on async content
UI Implementation Rule: If it's not in Flutter Flow, it's not in the app. Custom code only via business logic overlays.


